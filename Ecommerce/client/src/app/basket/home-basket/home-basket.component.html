@if(basketService.basket$ | async; as basket){

<div class="main-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="floating-elements">
      <div class="floating-shape shape1"></div>
      <div class="floating-shape shape2"></div>
      <div class="floating-shape shape3"></div>
    </div>
    <h1 class="display-4 fw-bold mb-3">
      <i class="fas fa-shopping-cart me-3"></i>
      سبد خرید شما
    </h1>
    <p class="lead mb-0">محصولات انتخابی خود را مدیریت کنید</p>
  </div>

  <!-- Cart Content -->
  <div class="cart-content">
    <!-- Cart Items Section -->
    <div class="cart-items-section">
      <h3 class="section-title">
        <i class="fas fa-list me-2"></i>
        محصولات سبد خرید (<span id="itemCount">{{basket.items.length}}</span> کالا)
      </h3>
      <div id="cartItems">
        @for (item of basket.items; track $index) {
        <!-- Cart Item 1 -->
        <div class="cart-item d-flex align-items-center" data-id="1">
          <div class="product-image">
            <img [src]="item.imageFile" class="img-thumbnail" alt="404">
          </div>
          <div class="product-info">
            <div class="product-name">{{item.productName}}</div>
            <!-- <div class="product-brand">{{item.}}</div> -->
            <div class="product-price">${{item.price | number}}</div>
            <div class="d-flex align-items-center justify-content-between">
              <div class="quantity-section">
                <label class="fw-semibold me-2">تعداد:</label>
                <div class="quantity-controls">
                  <button class="quantity-btn minus-btn" onclick="decreaseQuantity(1)">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input type="number" class="quantity-input" [value]="item.quantity" min="1" max="10" readonly
                    data-price="45000000">
                  <button class="quantity-btn plus-btn" onclick="increaseQuantity(1)">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
              <button class="remove-btn" onclick="removeItem(1)">
                <i class="fas fa-trash me-1"></i>
                حذف
              </button>
            </div>
          </div>
        </div>
        }
      </div>
      <div class="text-center mt-4">
        <a href="#" class="continue-shopping">
          <i class="fas fa-arrow-right me-2"></i>
          ادامه خرید
        </a>
      </div>
    </div>
    <!-- Cart Summary Section -->
    <div class="cart-summary-section">
      <h3 class="section-title">
        <i class="fas fa-calculator me-2"></i>
        خلاصه سفارش
      </h3>
      @if(basketService.basketTotal$ | async;as totalResult){
        <div class="cart-summary">
          <div class="summary-row">
            <span>جمع کالاها (<span id="totalItems">{{basket.items.length}}</span> کالا):</span>
            <span id="subtotal">${{totalResult.totalItems}}</span>
          </div>
          <div class="summary-row">
            <span>هزینه ارسال:</span>
            <span id="shipping">{{totalResult.shippingTotal}}</span>
          </div>
          <div class="summary-row">
            <span>تخفیف:</span>
            <span id="discount" class="text-success">{{totalResult.discount}}</span>
          </div>
          <div class="summary-row">
            <span>مالیات (9%):</span>
            <span id="tax">{{totalResult.tax}}</span>
          </div>
          <div class="summary-row total-row text-nowrap fs-6">
            <span>مبلغ قابل پرداخت:</span>
            <span id="total">{{totalResult.totalToPay}}</span>
          </div>
        </div>
      }

      <!-- Shipping Info -->
      <div class="shipping-info">
        <i class="fas fa-truck text-success me-2"></i>
        <strong>ارسال رایگان</strong> برای خرید بالای 50 میلیون تومان
      </div>

      <!-- Promo Code -->
      <div class="promo-section">
        <label class="fw-semibold mb-2">کد تخفیف:</label>
        <div class="input-group">
          <input type="text" class="form-control promo-input" id="promoCode" placeholder="کد تخفیف را وارد کنید">
          <button class="promo-btn" onclick="applyPromoCode()">
            اعمال
          </button>
        </div>
      </div>

      <!-- Checkout Button -->
      <button class="checkout-btn" onclick="proceedToCheckout()">
        <i class="fas fa-credit-card me-2"></i>
        تکمیل خرید
      </button>

      <!-- Payment Methods -->
      <div class="text-center mt-3">
        <small class="text-muted">روش‌های پرداخت امن:</small>
        <div class="mt-2">
          <i class="fab fa-cc-visa fa-2x text-primary me-2"></i>
          <i class="fab fa-cc-mastercard fa-2x text-warning me-2"></i>
          <i class="fas fa-university fa-2x text-success"></i>
        </div>
      </div>
    </div>
  </div>
</div>
}@else{
<div class="main-container">
  <!-- Cart Items Section -->
  <div class="cart-items-section">
    <!-- Empty Cart Message (Hidden by default) -->
    <div class="empty-cart" id="emptyCart">
      <i class="fas fa-shopping-cart"></i>
      <h3>سبد خرید شما خالی است</h3>
      <p>هنوز محصولی به سبد خرید خود اضافه نکرده‌اید</p>
      <a href="#" class="continue-shopping">ادامه خرید</a>
    </div>
  </div>
</div>
}
